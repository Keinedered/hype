# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É—Ä–æ–∫–æ–≤ (Lessons)

## –¢–∞–±–ª–∏—Ü–∞ `lessons` - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É—Ä–æ–∫–æ–≤

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `id` (String, PK) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–∫–∞
- `module_id` (String, FK ‚Üí modules.id, CASCADE) - **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** - —É—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –º–æ–¥—É–ª—é
- `title` (String) - –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `description` (Text) - –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞
- `content` (Text) - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ (Markdown)
- `video_url` (String) - URL –≤–∏–¥–µ–æ
- `video_duration` (String) - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ (—Ñ–æ—Ä–º–∞—Ç "MM:SS")
- `order_index` (Integer, default=0) - –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ –º–æ–¥—É–ª–µ
- `content_type` (String, default='text') - –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞: 'text', 'video', 'interactive', 'assignment'
- `tags` (Text) - –¢–µ–≥–∏ (JSON –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫)
- `estimated_time` (Integer, default=0) - –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö
- `status` (String, default='draft') - –°—Ç–∞—Ç—É—Å: 'draft', 'published', 'archived'
- `published_at` (DateTime) - –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `created_at` (DateTime, auto) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (DateTime, auto) - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

### 1. –°–≤—è–∑—å —Å –º–æ–¥—É–ª–µ–º (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø)
```
lessons.module_id ‚Üí modules.id (CASCADE DELETE)
```
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è –≤—Å–µ –µ–≥–æ —É—Ä–æ–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –£—Ä–æ–∫ –ù–ï –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –±–µ–∑ –º–æ–¥—É–ª—è

### 2. –°–≤—è–∑—å —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```
user_lessons.lesson_id ‚Üí lessons.id (CASCADE DELETE)
```
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —É—Ä–æ–∫—É (UniqueConstraint)

### 3. –°–≤—è–∑—å —Å –≤—ã–¥–µ—Ä–∂–∫–∞–º–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
```
handbook_excerpts.lesson_id ‚Üí lessons.id (CASCADE DELETE)
```
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –≤—ã–¥–µ—Ä–∂–∫–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- –û–¥–∏–Ω —É—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–¥–µ—Ä–∂–µ–∫

### 4. –°–≤—è–∑—å —Å –∑–∞–¥–∞–Ω–∏–µ–º
```
assignments.lesson_id ‚Üí lessons.id (CASCADE DELETE, UNIQUE)
```
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ –∫ —É—Ä–æ–∫—É
- –û–¥–∏–Ω —É—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ (1:1)

### 5. –°–≤—è–∑—å —Å –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –∑–∞–¥–∞–Ω–∏–π (—á–µ—Ä–µ–∑ assignment)
```
submissions.assignment_id ‚Üí assignments.id (CASCADE DELETE)
submission_files.submission_id ‚Üí submissions.id (CASCADE DELETE)
```
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ ‚Üí —É–¥–∞–ª—è–µ—Ç—Å—è assignment ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ submissions ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Ñ–∞–π–ª—ã

### 6. –°–≤—è–∑—å —Å –≥—Ä–∞—Ñ–æ–º –∑–Ω–∞–Ω–∏–π
```
graph_nodes.entity_id = lesson.id AND graph_nodes.type = 'lesson'
graph_edges.source_id ‚Üí graph_nodes.id (CASCADE DELETE)
graph_edges.target_id ‚Üí graph_nodes.id (CASCADE DELETE)
```
- –£–¥–∞–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `crud.delete_graph_node_for_lesson()`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –≥—Ä–∞—Ñ–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ–±—Ä–∞

## –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—Ä–æ–∫–∞ (LessonCreate)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
```python
{
    "id": "lesson-react-jsx",              # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    "module_id": "module-react-basics",    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ - –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ë–î
    "title": "JSX –≤ React",                 # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    "description": "–ò–∑—É—á–∞–µ–º JSX...",       # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    "content": "# JSX\n\n–ö–æ–Ω—Ç–µ–Ω—Ç...",      # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
}
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:
```python
{
    "video_url": "https://...",            # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    "video_duration": "15:30",             # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    "order_index": 1,                      # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
    "content_type": "text",                 # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'text')
    "tags": '["react", "jsx"]',           # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (JSON —Å—Ç—Ä–æ–∫–∞)
    "estimated_time": 30                   # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
}
```

## –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —É—Ä–æ–∫–∞

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ID —É—Ä–æ–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è (module_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: id, module_id, title, description, content

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```python
content_type = 'text' if not specified
estimated_time = 0 if not specified
order_index = 0 if not specified
status = 'draft' if not specified
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```python
new_lesson = models.Lesson(**lesson_data)
db.add(new_lesson)
db.flush()
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
```python
update_course_lesson_count(db, module.course_id)
# –û–±–Ω–æ–≤–ª—è–µ—Ç course.lesson_count - —Å—á–∏—Ç–∞–µ—Ç –≤—Å–µ —É—Ä–æ–∫–∏ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –∫—É—Ä—Å–∞
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–∞ –≥—Ä–∞—Ñ–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```python
if create_graph_node:
    crud.create_graph_node_for_lesson(
        db, new_lesson,
        x=x, y=y,
        auto_position=True,
        auto_create_edge=True  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑—å —Å –º–æ–¥—É–ª–µ–º
    )
```

### 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```python
safe_commit(db, "create_lesson")
```

## –ü—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞

### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
1. ‚úÖ `user_lessons` - –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚úÖ `handbook_excerpts` - –≤—ã–¥–µ—Ä–∂–∫–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
3. ‚úÖ `assignments` - –∑–∞–¥–∞–Ω–∏–µ –∫ —É—Ä–æ–∫—É
4. ‚úÖ `submissions` - –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏–π (—á–µ—Ä–µ–∑ assignment)
5. ‚úÖ `submission_files` - —Ñ–∞–π–ª—ã –æ—Ç–ø—Ä–∞–≤–æ–∫ (—á–µ—Ä–µ–∑ submissions)

### –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
1. üîß `graph_nodes` - —É–∑–µ–ª –≥—Ä–∞—Ñ–∞ –∑–Ω–∞–Ω–∏–π (—á–µ—Ä–µ–∑ `crud.delete_graph_node_for_lesson()`)
2. üîß `graph_edges` - —Ä–µ–±—Ä–∞ –≥—Ä–∞—Ñ–∞ (—É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–∞)

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤:
```python
update_course_lesson_count(db, course_id)
# –û–±–Ω–æ–≤–ª—è–µ—Ç course.lesson_count –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
```

## –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–£—Ä–æ–∫ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –º–æ–¥—É–ª—é** - `module_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å NULL
2. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —É—Ä–æ–∫–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—á–µ—Ç—á–∏–∫–∏** - `course.lesson_count` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞
4. **–°—Ç–∞—Ç—É—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –Ω–æ–≤—ã–µ —É—Ä–æ–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'draft'`
5. **–ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π** - —É–∑–µ–ª –≥—Ä–∞—Ñ–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é
6. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω —É—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ (assignment.lesson_id UNIQUE)

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### –¢–∞–±–ª–∏—Ü–∞ `user_lessons`
- –•—Ä–∞–Ω–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É—Ä–æ–∫–∞–º
- –°–≤—è–∑—å: `lesson_id ‚Üí lessons.id (CASCADE)`
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –ø–æ —É—Ä–æ–∫—É

### –¢–∞–±–ª–∏—Ü–∞ `handbook_excerpts`
- –•—Ä–∞–Ω–∏—Ç –≤—ã–¥–µ—Ä–∂–∫–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –¥–ª—è —É—Ä–æ–∫–∞
- –°–≤—è–∑—å: `lesson_id ‚Üí lessons.id (CASCADE)`
- –û–¥–∏–Ω —É—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–¥–µ—Ä–∂–µ–∫

### –¢–∞–±–ª–∏—Ü–∞ `assignments`
- –•—Ä–∞–Ω–∏—Ç –∑–∞–¥–∞–Ω–∏–µ –∫ —É—Ä–æ–∫—É
- –°–≤—è–∑—å: `lesson_id ‚Üí lessons.id (CASCADE, UNIQUE)`
- –û–¥–∏–Ω —É—Ä–æ–∫ - –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ (1:1)

### –¢–∞–±–ª–∏—Ü–∞ `submissions`
- –•—Ä–∞–Ω–∏—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –°–≤—è–∑—å: `assignment_id ‚Üí assignments.id (CASCADE)`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ ‚Üí —É–¥–∞–ª—è–µ—Ç—Å—è assignment ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ submissions

### –¢–∞–±–ª–∏—Ü–∞ `graph_nodes`
- –•—Ä–∞–Ω–∏—Ç —É–∑–ª—ã –≥—Ä–∞—Ñ–∞ –∑–Ω–∞–Ω–∏–π
- –°–≤—è–∑—å: `entity_id = lesson.id AND type = 'lesson'`
- –£–¥–∞–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞

